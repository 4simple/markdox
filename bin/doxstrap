#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander')
  , util = require('util')
  , format = util.format
  , async = require('async')
  , doxstrap = require('../')
  , docs = [];

// options

program
  .version(doxstrap.version)
  .command('doxstrap [options]... files...');

// examples

program.on('--help', function(){
  console.log('  Examples:');
  console.log('');
  console.log('    $ doxstrap myfile.js');
  console.log('    $ doxstrap myfile1.js myfile2.js');
  console.log('');
});

// parse argv

program.parse(process.argv);

// loop over files

async.forEach(program.args, function(arg, callback){

  doxstrap.parse(arg, function(err, doc){
    docs.push(doc);
    callback(err);
  });

}, function (err) {
  console.log('Generation starting');

  docs.forEach(function(doc, index, array){
    doxstrap.generate(doc);
  });

  console.log('Generation finished');
});